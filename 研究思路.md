
---

### **研究方案：基于异构时序图网络的跨主体信用风险传导预警**
**(版本：7.25)**

**研究总目标**: 构建一个能够动态捕捉多维企业关联性、并有效预测信用风险在复杂网络中传导路径的模型，最终实现对关联企业的精准、及时的风险预警。

---

### **1. 异构时序图谱构建：定义关联边界**

此为研究的基石，旨在构建一个能全面反映企业关联网络的**动态异构图 (Dynamic Heterogeneous Graph)**。

#### **1.1 节点 (Nodes): 定义网络参与主体**

*   **核心节点**: **企业** (包括上市公司、中小企业等，初期可优先选择数据更完备的上市公司)。
*   **辅助节点**: **个人** (如企业高管、法人、大股东) 与 **机构** (如持股基金)。
    *   *注：引入个人与机构节点能揭示更深层次的隐性关联，但数据获取与隐私问题需进一步论证，暂定为可选扩展项。*

#### **1.2 边 (Edges): 刻画多维关联关系**

为每一条边赋予**时间戳** (如关系建立/变更日期)，将静态图谱升级为**时序图谱**，这是捕捉风险动态传导的关键。

*   **强关联 (显性/业务关联)**:
    1.  **担保关系 (核心)**: 风险传导最直接的路径。
        *   **数据来源**: Wind, 天眼查, CSMAR, 同花顺等商业数据库。
        *   **属性**: 需包含担保金额（可进行归一化处理）、关系起始/结束时间戳，以捕捉时序动态。
    2.  **股权投资关系**: 包括直接与穿透后的间接持股。
        *   **数据来源**: 工商信息数据库。
        *   **属性**: 持股比例、投资时间点。
    3.  **董监高任职关系**: 基于共同或关联的董监高网络。
        *   **数据来源**: 工商信息数据库。
        *   **属性**: 可设定为无权图，或根据职位重要性（如董事长、法人 vs. 独立董事）赋予不同权重。

*   **弱关联 (隐性/行为关联)**:
    1.  **供应链关系**: 上下游业务依赖。
        *   **数据来源**: 上市公司年报披露的前五大客户与供应商。
        *   **属性**: 交易金额占总收入/成本的比例，关系方向（客户/供应商）。
    2.  **市场关联 (关键创新点)**: 由投资者行为驱动的非基本面关联。
        *   **构建方法**:
            *   **收益率相关性**: 计算企业股价/收益率时间序列的皮尔逊相关系数。
            *   **机构共同持股**: 分析机构投资者的投资组合重叠度。
        *   *注：可基于计算出的相似度矩阵，通过设定阈值或采用K近邻(KNN)方法筛选出显著关联边，以控制图的稀疏性。*

---

### **2. 多维特征工程：为网络注入生命力**

为图谱中的节点和边赋予丰富的、随时间变化的特征。

#### **2.1 节点特征 (Node Features)**

*   **静态特征**: 企业工商信息（如成立年限、注册资本、行业分类）。
*   **动态/时序特征**:
    *   **财务数据**: 季度/年度更新的资产负债率、现金流、利润率、偿债能力指标等。
    *   **经营数据**: 诉讼数量、行政处罚、专利/软著数量等事件的月度/季度变化。
    *   **市场表现**: 月度股价收益率、波动率、市值、换手率等。
    *   **舆情数据 (可选)**: 每日/每周的负面新闻计数、网络情感得分。

#### **2.2 边特征 (Edge Features)**

*   **担保关系**: 归一化后的担保金额、担保类型（如连带责任、一般保证）。
*   **股权关系**: 持股比例。
*   **市场关系**: 关系强度（如相关系数、持股重叠度）。
*   **供应链关系**: 交易金额占比。
*   **董监高关系**: 关系权重（如基于职位重要性赋值）。

#### **2.3 关键考量**

*   **特征全面性**: 最终特征集需根据数据源的可获得性进行最终确认与详细梳理。
*   **特征选择与降维**: 高维特征可能引入噪声。后续需评估是否采用PCA、互信息等方法进行特征筛选，以提升模型效率与鲁棒性。

---

### **3. 模型设计：HAG-Net (Hierarchical Attention Graph Network)**

**核心思想**: 通过 **节点级 → 关系级 → 时间级** 的三层分层注意力机制，端到端地学习复杂关联网络中的风险传导模式。

#### **第一层：节点级聚合 (Node-level Aggregation)**
*   **目标**: 回答“在同一种关系下，哪些邻居节点更重要？”。
*   **核心机制**: **带边权重的类型化图注意力网络 (Typed GAT with Edge Features)**。为每一种元路径（Metapath，如 `Company-Guarantees-Company`）设计一个独立的、能够融合边特征的 `GATv2Conv` 聚合器。
*   **实现流程**:
    1.  针对目标节点 `u` 和特定元路径 `r`，筛选出所有邻居 `v`。
    2.  使用该元路径专属的权重矩阵 `W_r` 对邻居特征 `x(v, t)` 进行线性变换。
    3.  **融合边特征计算注意力**: 将边特征 `edge_attr_uv` (如担保金额) 融入注意力系数的计算中。
        *   **公式示意**: `e_uv = Attn_r( W_u*x(u, t), W_v*x(v, t), W_e*edge_attr_uv )`
    4.  根据注意力权重 `α_uv` 对变换后的邻居信息进行加权聚合。
*   **产出**: 对于每个节点 `u`，生成一组“元路径特定”的嵌入向量：`{ h_担保(u,t), h_投资(u,t), ... }`。

#### **第二层：关系级聚合 (Relation-level Aggregation)**
*   **目标**: 回答“对于当前节点，哪种关系类型传递的信息更关键？”。
*   **核心机制**: **元路径注意力机制 (Metapath Attention)**。
*   **实现流程**:
    1.  **计算语义权重**: 使用一个注意力网络，动态学习每条元路径的重要性权重 `β_r`。该权重依赖于节点自身从各路径学到的表示。
        *   **公式示意**: `β_r = softmax_r( Attn_meta( h_r(u, t) ) )`
    2.  **语义融合**: 根据权重 `β_r` 对所有元路径的嵌入向量进行加权求和。
        *   **公式示意**: `h_空间(u, t) = Σ_r β_r * h_r(u, t)`
*   **产出**: 节点 `u` 在时刻 `t` 的**综合空间嵌入 (Comprehensive Spatial Embedding)** `h_空间(u, t)`，该向量融合了所有类型的空间关联信息。

#### **第三层：时间级聚合 (Temporal-level Aggregation)**
*   **目标**: 回答“节点的历史状态演变趋势如何影响未来风险？”。
*   **核心机制**: **循环神经网络 (RNN)**，如 **LSTM** 或 **GRU**。
*   **实现流程**:
    1.  对于每个节点 `u`，将其综合空间嵌入构成一个时间序列 `[h_空间(u,1), ..., h_空间(u,T)]`。
    2.  将此序列输入到 LSTM 或 GRU 中，捕捉其时序依赖性。
*   **产出**: 节点 `u` 的**最终时空嵌入 (Final Spatio-Temporal Embedding)** `h_final(u)`，即 RNN 在最后一个时间步的隐藏状态。

---

### **4. 实验设计：任务设定与评估指标**

#### **4.1 任务定义**
*   **问题类型**: **半监督节点分类任务** (Semi-supervised Node Classification)，因为网络中仅有部分企业拥有明确的风险标签。
*   **具体任务 (推荐)**: **二分类任务**。预测企业在未来T时间窗口内（如6个月、1年）是否会发生**硬性违约事件**（如债券违约、被ST等）。
    *   *优势：标签定义清晰、客观，噪声较小，便于模型训练与评估。*
*   **备选任务**: **多分类任务**。将企业风险划分为多个等级（如：正常、关注、预警、高风险）。
    *   *挑战：等级定义主观性强，需要明确的业务共识，否则易引入标签噪声。*

#### **4.2 损失函数**
*   采用**带权重的交叉熵损失 (Weighted Cross-Entropy Loss)**。由于违约事件是稀疏的（正样本远少于负样本），通过为正样本分配更高的权重，有效缓解类别不平衡问题。

#### **4.3 评估指标**
*   **AUC (Area Under ROC Curve)**: 衡量模型整体预测性能和排序能力的核心指标，对分类阈值不敏感。
*   **Precision@K / Recall@K**: 评估模型预警的实用性。在业务场景下，我们更关注模型预测的风险最高的K个企业中，命中了多少真实违约企业，这直接关系到预警的有效性和资源投入效率。

---

### **5. 模型可解释性与应用洞察**

模型不仅要精准预测，更要提供决策支持的洞察。本方案将从以下角度探索模型的可解释性：

*   **关键风险传导路径分析**: 通过分析**关系级注意力权重 (β)**，识别在风险传导中最主要的关联类型（如担保、供应链等），并探究其在不同市场环境下的动态变化。
*   **高风险行业/板块识别**: 结合企业行业标签，分析风险的聚集性，识别哪些行业或板块内部/之间的风险传导更为剧烈。
*   **个案深度剖析 (Case Study)**: 对特定的违约事件进行复盘，利用模型的**节点级注意力权重 (α)** 和时序分析，可视化地展示风险是如何从特定邻居、通过特定路径、在特定时间点一步步传导至目标企业。
*   **什么特征的企业是风险源**


---
## 7月28日第一次讨论
1. **找到一个baseline** 首先实现有意义的小幅度的创新
2. **找代码** 较小工作量 较低难度完成
---


## **研究思路修订版(8月6日版)**

**总目标：** 构建能够精准、及时预警企业信用风险传导的模型。

**研究路径（分阶段）：**

**第一阶段：构建静态多关系风险评估模型**

1.  **图谱构建：**
    *   **节点：** 企业。
    *   **边/关系类型：** 建立多个企业间的关系子图，如担保关系、股权投资关系、供应链关系、核心高管关联等。这些共同构成一个多关系图。
    *   **对异构的说明**：主要可能用到异构的地方在于董高监任职关系，所以我们无需构建一个“完全意义上的异构图”，我们的考虑需要分层次：首先**董高监数据**有没有意义，在此基础上，为什么不能用**关系**来替代，这需要实验来说明。    

2.  **模型设计 (对标 `Bi et al., 2024`):**
    *   采用**分层注意力网络**。
    *   **输入：** 企业节点特征 + 多个关系邻接矩阵。
    *   **企业级注意力层：** 对每一种关系，独立学习其邻居节点的注意力权重。
    *   **关系级注意力层：** 学习不同关系类型的重要性权重，并进行加权融合。
    *   **输出：** 每个企业的综合风险表示向量，并进行分类。

3.  **实验设计：**
    *   **基线模型：** GCN, GAT, GraphSAGE (在单一关系图或简单合并的图上运行)。以及credit risk领域的非图模型。
    *   **核心评估：** 证明我的多关系模型优于所有基线。
    *   **消融实验：** **逐一去掉某种关系**（如去掉投资关系），观察模型性能下降了多少，以此来量化**每种关系的“价值”** 



**第二阶段：引入动态时序建模 (Future Work)**

1.  **数据扩展：** 为所有关系和节点特征打上时间戳，构建时间序列的图快照。
2.  **模型扩展：**
    *   用第一阶段的模型作为每个时间步`t`的**“空间编码器”**，得到`t`时刻的节点风险表示`h(t)`。
    *   使用RNN (LSTM/GRU) 或Transformer来聚合时间序列 `[h(1), h(2), ..., h(T)]`，学习节点的**时序演化模式**。
3.  **实验评估：** 证明动态模型比静态模型能更早、更准地预测风险。



---

### **补充讨论**

#### **1. 研究主体选择：上市公司 vs. 中小企业 (SMEs)**

*   **议题**: 虽然担保关系在SMEs中更普遍（因其信息不对称、缺少抵押物），但SMEs的数据可获得性极差，特别是财务数据和风险标签难以获取。上市公司数据公开、完备且质量高。

#### **2. 关系类型的再审视与定义**

*   **担保关系**:
    *   **核心观察**: 上市公司的担保行为多为**战略性担保**，主要表现为“**为子公司或联营企业担保**”，这与股权/控制关系高度相关。为完全无关联第三方担保的情况较少，但一旦出现，通常是极强的风险信号。
*   **董监高任职关系**:
    *   **核心观察**: 高管因**忠实义务**，极少在无关联的多家公司同时任职。董事（特别是**独立董事**）和监事则可能出现交叉任职，形成一种“专家网络”或“社会资本”关联（也可能是子公司）。
*   **供应链关系**:
    *   **核心观察**: 供应链风险传导的核心是**现金流冲击**。经济学研究表明，下游客户的支付困难会直接影响上游供应商的现金流，是“应收账款”风险的直接体现。
*   **市场关联**:
    *   **决策**: 暂定。代码和思路可以借鉴THGNN论文(Zheng等, 2021)。

#### **3. 节点特征选择的逻辑**

*   **核心原则**: 所有特征选择都应围绕评估企业的“偿债能力”和“现金流稳定性”。
*   **借鉴方向**: 可借鉴经典的信用评级模型（如Z-score模型）和巴塞尔协议中的风险因子，筛选核心的财务比率（如流动比率、资产负债率、现金流利息保障倍数）和经营事件（如重大诉讼、被执行人信息）作为企业节点的“个性化”特征。
*   **借鉴(张宗新等, 2024)的指标**

#### **4. 关于获取金融机构内部数据**

*   **可能性与必要性**




---